---
title: '5 Security Hardening Steps to Do on Your Server If You Self-host'
date: '2024-02-20'
description: "Self-hosting is on the rise which we can't celebrate enough. These are the five steps we perform on every server we set up. You should run them too."
image: gimlet-io-whats-next-for-fluxcd-and-gimlet.jpg
---

**Self-hosting is on the rise which we can't celebrate enough. It is truly a way to save money when cloud pricing is not following the advancement in server hardware, and when SaaS is still sold per seat.**
---

Like DHH [argued](https://world.hey.com/dhh/dare-to-connect-a-server-to-the-internet-01d25a07) recently, running a server should not be mystified when you’d like to use software. But there are a few things we believe you should do on your server to increase its security.

## Scope
For practicality’s sake, we checked out four of the most well-known providers to see what measures can be taken without making adjustments to the Virtual Machine (VM) itself.

### AWS
Amazon Web Services provides different ways to secure EC2 instances by default. You’re able to configure SSH credentials to an instance, and you can also set up Identity and Access Management (IAM) policies in AWS.

AWS also supports one-time SSH keys, so you won’t have to maintain and secure long-term keys. You’re also able to set up SSH access restrictions. This way only users from a certain IP address or ranges can access your EC2 virtual machine.

### DigitalOcean
After sparking up your DigitalOcean droplet, you can use the Uncomplicated Firewall (UFW) to set up SSH keys. You can get started by using `ufw allow OpenSSH` in the terminal, and you can also enable firewall with `ufw enable`. To confirm if the firewall is set up, run `ufw status`.

### Scaleway
As usual, Scaleway allows you to add SSH keys while configuring your instance. On top of that, you can use security group settings to control inbound and outbound traffic. Restricting access to port 22 is a good idea here, since that’s used for SSH access.

### Hetzner
Hetzner also enables you to add SSH keys generated by you locally when setting up your VM. Also, you can add firewall policies that you’ve previously defined. If you haven’t, Hetzner will direct you to firewall settings where you can create new ones.

## Why do discount providers pose more work?
Budget-friendly VPS providers are great in case you need a server connected to the internet. They’re convenient, don’t require as much effort and money to set up as a Virtual Private Cloud (VPC) at AWS.

VPCs are good for a couple of reasons, including flexibility and security. But this requires lots of planning and effort to execute, including configuring network components, securing them, integrating them to your on-premises network when needed, tracking your network’s costs, and maintaining the network. Major providers offer an abundance of shortcuts to setting up a VPC - part of the reason why AWS bills going bonkers became a meme a while ago.

Setting up a VPC for business usage is a very reasonable decision. But for the purpose of hosting an application a VPS will do fine.

For this post, we chose Hetzner (not affiliated), but most of the work that needs to be done to secure the server will be unrelated to providers. We also chose Ubuntu Linux as it’s the most common option available.

## Securing access
Now that you have your VPS ready, you can use an SSH terminal (PuTTY on Windows, terminal on macOS and Linux) to connect to it. Use your root user and the generated password from your password manager.

First of all, you’ll need to secure the management entry point SSH, so only you and users trusted by you have SSH access.

As already described, some VPS providers will let you generate a password at setup time, others might let you upload an SSH key. For now, let’s assume you have a running VPS with a root password that you got from your provider. Let's log into the server with SSH and create a new user that you’ll use to manage the VPS.

After logging in, run the command below to create a new user. `superman` is the username we gave, you can specify anything.

```
adduser superman
```

The console will ask for a password for the user, enter one. If you don’t see any characters showing up when you type, don’t worry, it’s a security measure to hide the number of characters. Pro tip: always use a password manager and secure, high quality passwords!

Now add your user to the sudo group with the command below, so you will be able to fully administrate your server.

```
usermod -aG sudo superman
```

Now let’s create an SSH keypair for your user.

```
su - superman
ssh-keygen -t rsa -b 4096
```

It will ask you where it should save the files it generates, and the default `~/.ssh` is fine.

Enter a passphrase to protect your key. This is important, so only you can use your private key.

Now let’s add your public key to the users `authorized_keys` file, so you’ll be able to SSH into the server with it. Run the command below:

```
cat .ssh/id_rsa.pub >> .ssh/authorized_keys && chmod 600 .ssh/authorized_keys
```

Now before you start closing doors, you should test if you can SSH into your server with your new key. Save the `id_rsa` and `id_rsa.pub` files on your computer in a secure location. `id_rsa` is your private key, and you can rename it if you’d like to. Your private key should always be private, never share it with anyone. Your .pub key can be entered where you plan to use SSH.

Now, run the commands below. Copy and paste your server’s IP address in place of the <your-servers-ip> part of the first command.

For the first command, password shouldn’t be used. For the second, password will be asked.

```
ssh -l superman -i id_rsa <your-servers-ip>
sudo -i
```

If all is fine then you can start securing SSH daemon:

```
nano /etc/ssh/sshd_config
```

Find and uncomment the following lines. This will disable root access and password access to your server while only enabling the usage of the public key you saved a step earlier:

```
PermitRootLogin prohibit-password
PubkeyAuthentication yes
PasswordAuthentication no
```

To complete the process, you’ll have to restart the SSH process.

Be careful! Keep in mind that if you haven’t completed the steps described, you won’t be able to reach your server through SSH after restarting the SSH process with the command below:

```
systemctl restart sshd
```

By following these steps you’re able to secure your SSH server.

### fail2ban

Even though you just secured SSH access to your server, you may still need to let others have access to the server with usernames and passwords to be able to do certain things.

You can further protect your server by setting up [fail2ban](https://github.com/fail2ban/fail2ban). It’s a software that limits how many times someone can attempt to get access to your server from an IP address. It’s important because hackers could try to find out your password by trying different passwords. Failing to successfully access your server will ban them from trying - hence the name.

You can install it with the command below:

```
apt install fail2ban
echo -e "[sshd]\nbackend=systemd\nenabled=true" | sudo tee /etc/fail2ban/jail.local
systemctl enable fail2ban && systemctl start fail2ban
```  

To see if everything goes as planned, you can check fail2ban’s status:

```
>fail2ban-client status
```

By default, fail2ban will ban any IP that had more than 5 failed login attempts in 10 minutes for a 10 minute period. You can change this as you see fit, also you can set up an email address if you wish to be notified about ban events.

**Pro tip:** whitelist your home or office IP to avoid banning yourself. You can do this with the command below. Change the `<yourip>` part to your IP address:

```
echo "ignoreip = <yourip>" >> /etc/fail2ban/jail.local
systemctl restart fail2ban
```

### VPN

Most of the time your VPS will come with a public IP connected to the internet. If you don't want anybody else besides you and your trustees to be able to access services on your server, you can use a VPN solution.

Setting up a VPN is a difficult deal, we’d recommend asking help from someone familiar with VPNs.

## Security updates

Using some kind of patch management tool to keep your servers updated and critical vulnerability-free is recommended, however if you only run one or two VPS it might be an overkill.

Ubuntu’s UnattendedUpgrades come into play. It will automatically download and apply security upgrades on your server. Let's see how to turn it on:

Install UnattendedUpgrades - it might already be present on your system:

```
#apt install unattended-upgrades
```

If you choose to use UnattendedUpgrades, some services will require a restart after being updated. The tool can do this for you. To achieve this, you can edit the configurations of UnattendedUpgrades by running the command below:

```
nano /etc/apt/apt.conf.d/50unattended-upgrades
```

Once you’re in the configuration file, you can set `Unattended-Upgrade::Automatic-Reboot` to `true`.

After you made the change in the file, you can install a package that’ll take care of the reboots themselves. Use the following command:

```
apt install apt-config-auto-update
```

Now all that remains is to turn UnattendedUpgrades on and schedule it to run when the least amount of traffic is expected.

To turn it on, run the commands below:

```
systemctl enable unattended-upgrades
systemctl start unattended-upgrades
```

Now head back to the configuration file of the tool with `nano /etc/cron.d/unattended-upgrades`.

And add the line below. This’ll take care of looking for security updates at 2AM, when least traffic is expected:

```
``0 02 * * * root /usr/bin/unattended-upgrade -d
```

### Docker best practices

In case you’re using Docker images, you should look for rolling version tags, such as `latest` or `stable`.

## Firewalls versus docker

`ufw` is the default firewall frontend for Ubuntu but it’s not compatible with Docker. So if you’re using Docker, you should consider switching to firewalld.

Run the command below to remove ufw and install firewalld:

```
apt remove ufw
apt install firewalld
```

You’ll need to change the firewall’s backend also to iptables, as that’s compatible with Docker. Run this:

```
sed -i 's/FirewallBackend=nftables/FirewallBackend=iptables/g' /etc/firewalld/firewalld.conf FirewallBackend=iptables
systemctl enable firewalld
systemctl start firewalld
```

Here’s how you can check your firewall and add a new HTTP service to allow traffic even after rebooting, and then reload firewalld to apply changes.:

```
firewall-cmd --list-all-zones
firewall-cmd --zone=public --permanent --add-service=http
firewall-cmd --reload
```

## Backups

Backing up a server is a tedious task that can take up a lot of disk space, especially if you don’t back up critical files and folders. However creating a snapshot of a VPS server is a one button action that backs up your whole server as-is.

Some VPS providers might let you snapshot a server many times, some of them allow for one at a time. Some have APIs through which you could automate a daily snapshot.

It’s recommended to combine snapshots with local and remote backup scripts as well and do daily snapshots/backups to be safe.

## Cloudflare WAF

Even after doing everything described above, there are still a couple of things to consider. The more services you run, the more ports you open, the more surface you’ll have that needs protecting.

For example: if you’re running a WordPress based website, you’ll have opened your ports 80 and 443. And chances are, your WordPress admin site (usually `/wp-admin`) is accessible to anyone.

On the other hand, unprotected web applications are prone to be vulnerable against DDoS attacks. A DDoS attack is when someone directs so much traffic to your application, your app can’t handle it and crashes.

Something needs to be done about these things.

The solution is a Web Application Firewall (WAF). This’ll make up a security layer at the level of your hosted application, and Cloudflare offers it in their free plan, too. You can see how to set it up in this [guide](https://bobcares.com/blog/cloudflare-waf-setup/).

## CTA

CTA: call to action at the end

I am happy to funnel people to you to a one hour consultation for a fixed price kind of service

Also, if we end up creating a repo for people, we should funnel people to github.
